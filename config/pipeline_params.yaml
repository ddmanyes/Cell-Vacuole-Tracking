# Pipeline parameter reference (not auto-loaded)

input:
  tiff_path: data/bafA1/Group 1_wellA1_RI_MIP_stitched.tiff

output:
  results_dir: results
  qc_dir: results/qc

segmentation:
  method: cellpose
  min_cell_area: 200
  gaussian_sigma: 1.0
  peak_footprint: 7
  closing_disk: 5
  label_expand_pixels: 3
  target_coverage: 0.7
  max_expand_iter: 25

cellpose:
  model_type: cyto3
  diameter: 100
  cellprob_threshold: 0.6
  flow_threshold: 0.4
  min_size: 0
  use_clahe: true
  bg_subtract: rolling_ball
  rb_radius: 50
  fill_holes_area: 0
  closing_disk: 4

bubble:
  method: rb_clahe
  blob_log:
    min_sigma: 2
    max_sigma: 15
    threshold: 0.03
    num_sigma: 3
  tophat:
    radius: 2
    smooth_sigma: 0.6
    min_area: 3
    max_area: 120
  watershed:
    smooth_sigma: 1.0
    intensity_threshold: 0.25
    marker_quantile: 0.25
  cellpose:
    model_type: cyto3
    diameter: 10
    cellprob_threshold: 0.0
    flow_threshold: 0.4
    min_size: 0
    smooth_sigma: 1.0
  rb_clahe:
    # 泡泡偵測門檻 (0-1): 越低越嚴格 (只抓很黑的)，越高越鬆 (抓比較淡的)
    thresh: 0.28
    # 最小泡泡面積 (pixels): 過濾掉太小的雜訊點
    min_area: 10
    # 最大泡泡面積 (pixels): 過濾掉太大的誤判 (null 表示不限制)
    max_area: null
    # 最小圓度 (0-1): 1.0 為正圓。數值越低允許形狀越不規則
    min_circularity: 0.1
    # CLAHE 對比強化參數: 越高對比越強，但也可能放大雜訊
    clahe_clip: 0.5
    # 滾動球半徑: 用於背景扣除，通常設為細胞直徑的一半左右
    rb_radius: 50

bubble_qc_overlay:
  min_sigma: 1
  max_sigma: 8
  threshold: 0.02

tracking:
  enabled: true
  track_cost_cutoff: 50.0
  splitting_cost_cutoff: false
  merging_cost_cutoff: false

runtime:
  sample_frame: null
  skip_tracking: false
  max_frames: null

intermediate:
  save: false
  dir: results/intermediates

bubble_sweep:
  # 參數掃描範圍設定
  thresh: [0.25]
  min_area: [5, 10, 15, 20]
  clahe_clip: [0.30, 0.35, 0.40, 0.45]

