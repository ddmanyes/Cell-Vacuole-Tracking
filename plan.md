這份計畫以 **TIFF 影像** 為主要輸入，目標是建立一個可重現且可擴充的分析流程：
Cellpose 分割 → 追蹤 → 細胞內氣泡分析 → 統計輸出。

### 1. 檔案盤點與輸入規則

1. 使用 `data/bafA1` 與 `data/control` 內的 TIFF：
   - `Group 1_wellA1_RI_MIP_stitched.tiff`
   - `Group 2_wellA2_RI_MIP_stitched.tiff`
2. 忽略 `.avi` 與 `._` 前綴的 macOS metadata 檔案。
3. 每個檔案視為獨立的 time-lapse 影片進行分析。

### 2. TIFF 內容驗證

1. 確認每個 TIFF 的維度格式（預期為 `T, Y, X`）。
2. 讀取 `dtype` 與強度範圍，決定是否需要正規化或對比增強。
3. 建立簡短報告：每個檔案的幀數、影像尺寸、位元深度。

### 3. 分割與追蹤策略

1. **Cellpose**：使用 `cyto3` 分割細胞。
2. **追蹤**：先以 LapTrack 為主，使用 centroid + IoU 對應。
3. 紀錄每幀的 `cell_id` 與對應 mask label，建立可追溯的 ID 映射表。

### 4. 氣泡偵測流程

1. 針對每顆細胞 ROI 做局部影像正規化（可選 CLAHE）。
2. 使用 `blob_log` 或閾值 + 連通元件作為兩種可切換方法。
3. 對每顆細胞輸出：
   - 氣泡數量
   - 氣泡總面積
   - 氣泡密度（每像素）

### 5. 統計輸出與品質檢查

1. 輸出 CSV（每幀、每細胞一列）。
2. 產生快速 QC：
   - 每幀細胞數
   - 平均氣泡數
   - 代表影像疊圖（原圖 + mask + bubble 位置）

### 6. 交付項目

1. 可執行腳本（支援 batch 分析兩個資料夾）。
2. 範例輸出 CSV。
3. QC 影像與簡短說明。

---

如果你確認這份計畫沒問題，我會開始：
1) 先驗證 TIFF 結構與維度，
2) 再產出第一版可執行腳本。